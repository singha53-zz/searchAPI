<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Search API</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B"
    crossorigin="anonymous">
  <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">Search API</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
      aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse " id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto ">
        <li class="nav-item active">
          <a class="nav-link" href="#giphy">Giphy</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#movies">Movies</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#bands">Bands</a>
        </li>
      </ul>
    </div>
  </nav>

  <div class="container">
    <section id="giphy">
      <h1 style="text-align: center;">Search Giphy</h1>
      <hr>
      <div class="row">
        <div class="col-12">
          <form>
            <div class="form-group">
              <label for="topic">Topic:</label>
              <input type="text" id="topic" placeholder="Enter topic to search">
            </div>
            <div class="form-group">
              <label for="topic">Limit:</label>
              <input type="text" id="limit" placeholder="Enter # of giphies to fetch!">
            </div>
            <div class="form-group">
              <button id="find-giphy" type="submit" class="btn btn-primary">Fetch!</button>
            </div>
          </form>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-12" id="giphyButtons"></div>
      </div>
      <div class="row">
        <div class="col-12" id="giphyTable">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">Title</th>
                <th scope="col">Trending date</th>
                <th scope="col">Image</th>
                <th scope="col">Rating</th>
              </tr>
            </thead>
            <tbody>
              <!-- Insert movie rows here -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <hr>

    <section id="movies">
      <h1>Movies</h1>
      <p>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Dolores in explicabo necessitatibus eaque, minus exercitationem
        maxime sapiente nihil voluptatibus voluptatum ea quae aperiam ut suscipit. Illo blanditiis itaque maiores aliquam!
        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Delectus, quaerat id? Non hic natus vero ipsum laudantium
        reiciendis odit facere corrupti atque, fugit sint assumenda, quis, dolore quam quo quisquam ullam ab eaque molestiae
        officia! Quaerat quisquam amet dignissimos numquam temporibus quasi quibusdam vitae dolores atque animi illum nihil
        eveniet porro dolor, veniam et officiis consequuntur earum, repudiandae, maiores aliquid voluptatum enim rerum? Saepe
        doloribus quos delectus molestias, nesciunt impedit quam aliquid tempora est atque odit debitis esse consequatur
        temporibus provident minima eum cum? Maiores rerum fuga minus quae reiciendis corporis facilis odio perspiciatis,
        ullam quas accusantium est labore dolores.</p>
    </section>

    <hr>

    <section id="bands">
      <h1>Bands</h1>
      <p>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Dolores in explicabo necessitatibus eaque, minus exercitationem
        maxime sapiente nihil voluptatibus voluptatum ea quae aperiam ut suscipit. Illo blanditiis itaque maiores aliquam!
        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Delectus, quaerat id? Non hic natus vero ipsum laudantium
        reiciendis odit facere corrupti atque, fugit sint assumenda, quis, dolore quam quo quisquam ullam ab eaque molestiae
        officia! Quaerat quisquam amet dignissimos numquam temporibus quasi quibusdam vitae dolores atque animi illum nihil
        eveniet porro dolor, veniam et officiis consequuntur earum, repudiandae, maiores aliquid voluptatum enim rerum? Saepe
        doloribus quos delectus molestias, nesciunt impedit quam aliquid tempora est atque odit debitis esse consequatur
        temporibus provident minima eum cum? Maiores rerum fuga minus quae reiciendis corporis facilis odio perspiciatis,
        ullam quas accusantium est labore dolores.</p>
    </section>
  </div>


  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js" integrity="sha384-o+RDsa0aLu++PJvFqy8fFScvbHFLtbvScb8AjopnFD+iEQ7wo/CG0xlczd+2O/em"
    crossorigin="anonymous"></script>
  <script>
    var giphyArray = ['toronto', 'soccer', 'nba', 'roses'];
    var moviesArray = ['avatar', 'lion king', 'Her', '300'];
    var bandsArray = ['Beetles', 'Drake', 'Taylor Swift', 'roses'];

    // render buttons
    renderButtons(giphyArray, "giphy")
    console.log(giphyArray)

    // clicking giphy fetch button
    $("#find-giphy").on("click", function (event) {
      event.preventDefault();
      var type = $(this)[0].id
      // save inputs
      var params = {
        giphyTopic: $("#topic").val(),
        giphyLimit: parseInt($("#limit").val())
      }
      console.log(params)
      displayInfo(type, params)

    })
    // clicking movies fetch button
    $("#find-movie").on("click", function (event) {
      event.preventDefault();
      console.log($(this)[0].id)
    })
    // clicking bands fetch button
    $("#find-band").on("click", function (event) {
      event.preventDefault();
      console.log($(this)[0].id)
    })

    // clicking on a giphy button
    $(document).on("click", ".giphy-btn", function (event) {
      console.log(event.target.textContent)
      var params = {
        giphyTopic: event.target.textContent,
        giphyLimit: parseInt($("#limit").val())
      }
      console.log(params)
      displayInfo("find-giphy", params)
    });
    // clicking on a giphy button
    $(document).on("click", ".movie-btn", displayInfo);
    // clicking on a giphy button
    $(document).on("click", ".band-btn", displayInfo);

    function displayInfo(type, params) {
      if (type === "find-giphy") {
        if (params.giphyTopic !== "" && !isNaN(params.giphyLimit)) {
          giphyArray.push(params.giphyTopic)

          // display buttons
          renderButtons(giphyArray, "giphy")

          // display table with metadata
          var queryGiphy = `https://api.giphy.com/v1/gifs/search?api_key=RiOoaXfWH40EgxNi08rN7WLGTFffEMgN&q=${params.giphyTopic}&limit=${params.giphyLimit}&offset=0&rating=G&lang=en`

          $.ajax({
            url: queryGiphy,
            method: "GET"
          }).then(result => {
            var cleanData = cleanAjax(result, "giphy")
            console.log(cleanData)
            makeTable(cleanData, "giphy")
          }).catch(err => {
            console.log(err)
          });
        } else {
          if (isNaN(params.giphyLimit)) {
            alert("Please put a number for the Limit")
          } else {
            alert("No results were found!")
          }
        }
      } else if (type === "find-movie") {

      } else if (type === "find-band") {

      }
    }

    function renderButtons(arr, form) {
      arr = Array.from(new Set(arr))
      if (form === "giphy") {
        $("#giphyButtons").empty();
        for (let i = 0; i < arr.length; i++) {
          var newButton = $("<button>")
          newButton.text(arr[i])
          newButton.addClass("btn")
          newButton.addClass("btn-primary")
          newButton.addClass("giphy-btn")
          newButton.attr("data-name", arr[i]);
          $("#giphyButtons").prepend(newButton)
        }
      } else if (form === "movies") {
        console.log("hi")
      } else if (form === "bands") {
        console.log("hi")

      }
    }

    function cleanAjax(result, form) {

      if (form === "giphy") {
        var url = [];
        var title = [];
        var rating = [];
        var trending_datetime = [];
        for (let i = 0; i < result.data.length; i++) {
          url.push(result.data[i].images.fixed_height.url)
          title.push(result.data[i].title)
          rating.push(result.data[i].rating)
          trending_datetime.push(result.data[i].trending_datetime)
        }
        return { title: title, trending_datetime: trending_datetime, url: url, rating: rating }
      } else if (form === "movies") {
        console.log("hi")
      } else if (form === "bands") {
        console.log("hi")
      }
    }

    function makeTable(ajaxResult, form) {
      console.log(ajaxResult)
      console.log(form)
      if (form === "giphy") {
        for (let i = 0; i < ajaxResult.rating.length; i++) {
          var tBody = $("tbody");
          var tRow = $("<tr>");
          var titleTd = $("<td>").text(ajaxResult.title[i]);
          var dateTd = $("<td>").text(ajaxResult.trending_datetime[i]);
          var imageTd = $("<td>").html(`<img class="img-thumbnail gif" src=${ajaxResult.url[i].replace('.gif', '_s.gif')} data-still=${ajaxResult.url[i].replace('.gif', '_s.gif')} data-animate=${ajaxResult.url[i]} state="still">`);
          var ratingTd = $("<td>").text(ajaxResult.rating[i].toUpperCase())
          tRow.append(titleTd, dateTd, imageTd, ratingTd);
          tBody.prepend(tRow);
        }
      } else if (form === "movies") {
        console.log("hi")
      } else if (form === "bands") {
        console.log("hi")
      }
    }

    // add play and pause functionality to gifs
    $(document).on("click", ".gif", function () {
      // The attr jQuery method allows us to get or set the value of any attribute on our HTML element
      console.log("button clicked!")
      var state = $(this).attr("data-state");
      // If the clicked image's state is still, update its src attribute to what its data-animate value is.
      // Then, set the image's data-state to animate
      // Else set src to the data-still value
      if (state === "still") {
        $(this).attr("src", $(this).attr("data-animate"));
        $(this).attr("data-state", "animate");
      } else {
        $(this).attr("src", $(this).attr("data-still"));
        $(this).attr("data-state", "still");
      }
    });

  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

</body>

</html>