<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Search API</title>
  <!-- Reset CSS -->
  <link rel="stylesheet" href="assets/css/reset.css">
  <!-- Font awesome -->
  <link href="https://fonts.googleapis.com/css?family=Monoton" rel="stylesheet">
  <!-- Bootstrap CDN -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B"
    crossorigin="anonymous">
  <!-- App CSS -->
  <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>

  <!-- Navigation bar -->
  <nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary">
    <a class="navbar-brand" href="#">Search API</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
      aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse " id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto ">
        <li class="nav-item active">
          <a class="nav-link" href="#giphy"> Giphy</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#movies">Movies</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#bands">Bands</a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Giphy search API -->
  <div class="container">
    <section id="giphy">
      <div class="jumbotron">
        <h1 style="text-align: center;">Giphy</h1>
      </div>
      <hr>
      <div class="row">
        <div class="col-12" style="display: flex; justify-content: center">
          <form class="well form-search" id="search-by-id-form" onsubmit="return false;">
            <div>
              <label class="control-label" for="topic">Topic:</label>
              <input type="text" id="topic" class="input-small" placeholder="Topic query"> &nbsp;&nbsp;
              <label class="control-label" for="limit">Limit:</label>
              <input type="text" id="limit" class="input-small" placeholder="Number of giphies"> &nbsp;&nbsp;
              <label class="control-label" for="rating">Rating:</label>
              <select id="rating" style="width: 100px;">
                <option value="G">G</option>
                <option value="PG">PG</option>
                <option value="PG-13">PG-13</option>
              </select>
              &nbsp;&nbsp;
              <button id="find-giphy" type="button" class="btn-sm btn-primary">Search</button>
              <button id="reset-giphy" type="reset" class="btn-sm reset">Reset</button>
            </div>
          </form>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-12" id="giphyButtons"></div>
      </div>
      <div class="row">
        <div class="col-12" id="giphyTable">
          <div class="table-wrapper-scroll-y">
            <table class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th scope="col">Title</th>
                  <th scope="col">Trending date</th>
                  <th scope="col">Image</th>
                  <th scope="col">Rating</th>
                </tr>
              </thead>
              <tbody id="giphy-tbody">
                <!-- Insert giphies rows here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <hr>

    <!-- OMDB movie search API -->
    <section id="movies">
      <div class="jumbotron">
        <h1 style="text-align: center;">OMDB</h1>
      </div>
      <hr>
      <div class="row">
        <div class="col-12" style="display: flex; justify-content: center">
          <form class="well form-search" id="search-by-id-form" onsubmit="return false;">
            <div>
              <label class="control-label" for="movie-title">Title:</label>
              <input type="text" id="movie-title" class="input-small" placeholder="Movie title"> &nbsp;&nbsp;
              <label class="control-label" for="movie-plot">Plot:</label>
              <select id="movie-plot" style="width: 100px;">
                <option value="Short" selected="">Short</option>
                <option value="full">Full</option>
              </select>
              &nbsp;&nbsp;
              <label class="control-label" for="movie-type">Type:</label>
              <select id="movie-type" style="width: 100px;">
                <option value="movie">movie</option>
                <option value="series">series</option>
                <option value="episode">episode</option>
              </select>
              &nbsp;&nbsp;
              <button id="find-movie" type="button" class="btn-sm btn-primary">Search</button>
              <button id="reset-movie" type="reset" class="btn-sm reset">Reset</button>
            </div>
          </form>
        </div>
      </div>


      <hr>
      <div class="row">
        <div class="col-12" id="movieButtons"></div>
      </div>
      <div class="row">
        <div class="col-12" id="movieTable">
          <div class="table-wrapper-scroll-y">
            <table class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th scope="col">Title</th>
                  <th scope="col">Year</th>
                  <th scope="col">Image</th>
                  <th scope="col">Plot</th>
                </tr>
              </thead>
              <tbody id="movie-tbody">
                <!-- Insert movie rows here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <hr>

    <!-- Bands in Town API -->
    <section id="bands">
      <div class="jumbotron">
        <h1 style="text-align: center;">Bands &nbsp&nbsp in &nbsp&nbsp Town</h1>
      </div>
      <hr>
      <div class="row">
        <div class="col-12" style="display: flex; justify-content: center">
          <form class="well form-search" id="search-by-id-form" onsubmit="return false;">
            <div>
              <label class="control-label" for="band-name">Name:</label>
              <input type="text" id="band-name" class="input-small" placeholder="Artist name"> &nbsp;&nbsp;
              <label class="control-label" for="band-venue">Venue Location:</label>
              <select id="band-venue" style="width: 100px;">
                <option value="United States" selected="">USA</option>
                <option value="Canada">Canada</option>
                <option value="full">Other</option>
              </select>
              &nbsp;&nbsp;
              <button id="find-band" type="button" class="btn-sm btn-primary">Search</button>
              <button id="reset-band" type="reset" class="btn-sm reset">Reset</button>
            </div>
          </form>
        </div>
      </div>


      <hr>
      <div class="row">
        <div class="col-12" id="bandsButtons"></div>
      </div>
      <div class="row">
        <div class="col-12" id="bandTable">
          <div class="table-wrapper-scroll-y">
            <table class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th scope="col">Artist(s)</th>
                  <th scope="col">Date</th>
                  <th scope="col">Venue</th>
                  <th scope="col">Tickets</th>
                </tr>
              </thead>
              <tbody id="band-tbody">
                <!-- Insert band rows here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
    <br>
  </div>

  <!-- jQuery CDN -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <!-- JS code for navbar hamburger icon to work -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js" integrity="sha384-o+RDsa0aLu++PJvFqy8fFScvbHFLtbvScb8AjopnFD+iEQ7wo/CG0xlczd+2O/em"
    crossorigin="anonymous"></script>
  <!-- App javascript script -->
  <!-- <script src="assets/javascript/app.js"></script> -->
  <script>
    // default search buttons
    var giphyArray = ['toronto', 'soccer', 'nba', 'roses'];
    var moviesArray = ['avatar', 'lion king', 'Her', '300'];
    var bandsArray = ['Cher', 'Drake', 'Taylor Swift', 'Chaos'];

    // render buttons
    renderButtons(giphyArray, "giphy")
    renderButtons(moviesArray, "movies")
    renderButtons(bandsArray, "bands")

    // clicking giphy fetch button
    $("#find-giphy").on("click", function (event) {
      event.preventDefault();
      var type = $(this)[0].id
      // save inputs
      var params = {
        giphyTopic: $("#topic").val(),
        giphyLimit: parseInt($("#limit").val()),
        giphyRating: $("#rating").val()
      }

      displayInfo(type, params)

    })
    // clicking movies fetch button
    $("#find-movie").on("click", function (event) {
      event.preventDefault();
      var type = $(this)[0].id

      // save inputs
      var params = {
        movieTitle: $("#movie-title").val(),
        moviePlot: $("#movie-plot").val(),
        movieType: $("#movie-type").val()
      }

      displayInfo(type, params)
    })
    // clicking bands fetch button
    $("#find-band").on("click", function (event) {
      event.preventDefault();
      event.preventDefault();
      var type = $(this)[0].id

      // save inputs
      var params = {
        bandTitle: $("#band-name").val(),
        bandVenue: $("#band-venue").val()
      }

      displayInfo(type, params)
    })

    // clicking on a giphy button
    $(document).on("click", ".giphy-btn", function (event) {

      var params = {
        giphyTopic: event.target.textContent,
        giphyLimit: parseInt($("#limit").val()),
        giphyRating: $("#rating").val()
      }

      displayInfo("find-giphy", params)
    });
    // clicking on a movie button
    $(document).on("click", ".movie-btn", function (event) {

      var params = {
        movieTitle: event.target.textContent,
        moviePlot: $("#movie-plot").val().toLowerCase(),
        movieType: $("#movie-type").val()
      }

      displayInfo("find-movie", params)
    });
    // clicking on a band button
    $(document).on("click", ".band-btn", function (event) {
      var params = {
        bandTitle: event.target.textContent,
        bandVenue: $("#band-venue").val()
      }

      displayInfo("find-band", params)
    });

    // clear table upon clicking the reset buttons
    $(document).on("click", ".reset", function (event) {
      console.log(event)
    })

    // display table
    function displayInfo(type, params) {
      if (type === "find-giphy") {
        if (params.giphyTopic !== "" && !isNaN(params.giphyLimit)) {
          giphyArray.push(params.giphyTopic)

          // display buttons
          renderButtons(giphyArray, "giphy")

          // display table with metadata
          var queryGiphy = `https://api.giphy.com/v1/gifs/search?api_key=RiOoaXfWH40EgxNi08rN7WLGTFffEMgN&q=${params.giphyTopic}&limit=${params.giphyLimit}&offset=0&rating=${params.giphyRating.toLowerCase()}&lang=en`

          $.ajax({
            url: queryGiphy,
            method: "GET"
          }).then(result => {
            var cleanData = cleanAjax(result, "giphy")
            makeTable(cleanData, "giphy")
          }).catch(err => {
            console.log(err)
          });
        } else if (isNaN(params.giphyLimit)) {
          alert("Please put a number for the Limit")
        }
      } else if (type === "find-movie") {
        if (params.movieTitle !== "" && params.moviePlot !== "" && params.movieType !== "") {
          moviesArray.push(params.movieTitle)

          // display buttons
          renderButtons(moviesArray, "movies")

          // display table with metadata
          var queryMovie = `https://www.omdbapi.com/?t=${params.movieTitle}&y=&plot=${params.moviePlot}&type=${params.movieType}&apikey=trilogy`;

          $.ajax({
            url: queryMovie,
            method: "GET"
          }).then(result => {

            var cleanData = cleanAjax(result, "movies")
            if (cleanData.title === undefined) {
              return alert("No results were found!")
            } else {
              makeTable(cleanData, "movies")
            }
          }).catch(err => {
            console.log(err)
          });
        }
      } else if (type === "find-band") {
        if (params.bandTitle !== "") {
          bandsArray.push(params.bandTitle)

          // display buttons
          renderButtons(bandsArray, "bands")

          // display table with metadata

          var queryVenue = `https://rest.bandsintown.com/artists/${params.bandTitle}/events?app_id=codingbootcamp`;

          $.ajax({
            url: queryVenue,
            method: "GET"
          }).then(result => {

            // if venue location is other
            if ((params.bandVenue === "United States") || (params.bandVenue === "Canada")) {
              var filteredResult = result.filter(country => {
                return country.venue.country === params.bandVenue
              })
            } else {
              var filteredResult = result.filter(country => {
                return country.venue.country !== 'United States' && country.venue.country !== 'Canada'
              })
            }

            if (filteredResult.length === 0) {
              alert("No results were found!")
            } else {
              var cleanData = cleanAjax(filteredResult, "bands")
              makeTable(cleanData, "bands")
            }
          }).catch(err => {
            console.log(err)
            alert("No results were found!")
          });
        }
      }
    }

    function renderButtons(arr, form) {
      arr = Array.from(new Set(arr))
      if (form === "giphy") {
        $("#giphyButtons").empty();
        for (let i = 0; i < arr.length; i++) {
          var newButton = $("<button>")
          newButton.text(arr[i])
          newButton.addClass("btn")
          newButton.addClass("btn-info")
          newButton.addClass("giphy-btn")
          newButton.attr("data-name", arr[i]);
          $("#giphyButtons").prepend(newButton)
        }
      } else if (form === "movies") {
        $("#movieButtons").empty();
        for (let i = 0; i < arr.length; i++) {
          var newButton = $("<button>")
          newButton.text(arr[i])
          newButton.addClass("btn")
          newButton.addClass("btn-info")
          newButton.addClass("movie-btn")
          newButton.attr("data-name", arr[i]);
          $("#movieButtons").prepend(newButton)
        }
      } else if (form === "bands") {
        $("#bandsButtons").empty();
        for (let i = 0; i < arr.length; i++) {
          var newButton = $("<button>")
          newButton.text(arr[i])
          newButton.addClass("btn")
          newButton.addClass("btn-info")
          newButton.addClass("band-btn")
          newButton.attr("data-name", arr[i]);
          $("#bandsButtons").prepend(newButton)
        }
      }
    }

    function cleanAjax(result, form) {

      if (form === "giphy") {
        var url = [];
        var title = [];
        var rating = [];
        var trending_datetime = [];
        for (let i = 0; i < result.data.length; i++) {
          url.push(result.data[i].images.fixed_height.url)
          title.push(result.data[i].title)
          rating.push(result.data[i].rating)
          trending_datetime.push(result.data[i].trending_datetime)
        }
        return { title: title, trending_datetime: trending_datetime, url: url, rating: rating }
      } else if (form === "movies") {
        var title = result.Title;
        var year = result.Year;
        var url = result.Poster;
        var plot = result.Plot;
        return { title: title, year: year, url: url, plot: plot }
      } else if (form === "bands") {
        var artist = [];
        var date = [];
        var venue = [];
        var tickets = [];
        for (let i = 0; i < result.length; i++) {
          artist.push(result[i].lineup[0])
          date.push(result[i].datetime)
          venue.push(`${result[i].venue.name}, ${result[i].venue.city}, ${result[i].venue.country}`)
          tickets.push(result[i].url)
        }
        return { artist: artist, date: date, venue: venue, tickets: tickets }
      }
    }

    function makeTable(ajaxResult, form) {
      if (form === "giphy") {
        for (let i = 0; i < ajaxResult.rating.length; i++) {
          var tBody = $("#giphy-tbody");
          var tRow = $("<tr>");
          var titleTd = $("<td>").text(ajaxResult.title[i]);
          var dateTd = $("<td>").text(ajaxResult.trending_datetime[i]);
          var imageTd = $("<td>").html(`<img class="img-thumbnail gif" src=${ajaxResult.url[i].replace('.gif', '_s.gif')} data-still=${ajaxResult.url[i].replace('.gif', '_s.gif')} data-animate=${ajaxResult.url[i]} state="still">`);
          var ratingTd = $("<td>").text(ajaxResult.rating[i].toUpperCase())
          tRow.append(titleTd, dateTd, imageTd, ratingTd);
          tBody.prepend(tRow);
        }
      } else if (form === "movies") {
        var tBody = $("#movie-tbody");
        var tRow = $("<tr>");
        var titleTd = $("<td>").text(ajaxResult.title);
        var yearTd = $("<td>").text(ajaxResult.year);
        var imageTd = $("<td>").html(`<img class="img-thumbnail gif" src=${ajaxResult.url}>`);
        var plotTd = $("<td>").text(ajaxResult.plot)
        tRow.append(titleTd, yearTd, imageTd, plotTd);
        tBody.prepend(tRow);
      } else if (form === "bands") {
        for (let i = 0; i < ajaxResult.artist.length; i++) {
          var tBody = $("#band-tbody");
          var tRow = $("<tr>");
          var artistTd = $("<td>").text(ajaxResult.artist[i]);
          var dateTd = $("<td>").text(ajaxResult.date[i])
          var venueTd = $("<td>").text(ajaxResult.venue[i])
          var ticketsTd = $("<td>").html(`<a href=${ajaxResult.tickets[i]} target="_blank"><button class="btn btn-info">Get tickets!</button></a>`)
          tRow.append(artistTd, dateTd, venueTd, ticketsTd);
          tBody.prepend(tRow);
        }
      }
    }

    // add play and pause functionality to gifs
    $(document).on("click", ".gif", function () {
      // The attr jQuery method allows us to get or set the value of any attribute on our HTML element
      var state = $(this).attr("data-state");
      // If the clicked image's state is still, update its src attribute to what its data-animate value is.
      // Then, set the image's data-state to animate
      // Else set src to the data-still value
      if (state === "still") {
        $(this).attr("src", $(this).attr("data-animate"));
        $(this).attr("data-state", "animate");
      } else {
        $(this).attr("src", $(this).attr("data-still"));
        $(this).attr("data-state", "still");
      }
    });

  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

</body>

</html>